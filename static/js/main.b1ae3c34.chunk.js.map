{"version":3,"sources":["pages/setting/JoplinSetting.tsx","pages/setting/index.ts","pages/setting/JoplinSetting.module.css","pages/home/Home.module.css","serviceWorker.ts","pages/tag/api/TagCloudApi.ts","pages/tag/TagCloud.tsx","pages/relation/RelationMap.tsx","pages/relation/util/NoteRelationConvertUtil.ts","pages/home/Home.tsx","pages/demo/CreateNoteDemo.tsx","pages/sunburst/NotebookSunburst.tsx","pages/sunburst/util/getNotebookSunburstData.ts","pages/timeline/NoteTimeline.tsx","component/router/routeList.ts","common/util/proxyStorage.ts","App.tsx","index.tsx","common/hooks/useMessage.ts"],"names":["i18nOptions","lng","navigator","language","fallbackLng","resources","en","translation","successMsg","errorMsg","settingFormHeader","tokenLabel","tokenErrorRequiredMsg","portLabel","portErrorRequiredMsg","submitText","JoplinSetting","i18nLoad","useAsync","i18next","init","register","handleSubmit","errors","useForm","defaultValues","port","setSettingForm","useLocalStorage","history","useHistory","success","error","useMessage","value","container","justify","alignItems","className","css","maxWidth","component","variant","t","onSubmit","async","data","console","log","config","token","noteApi","list","fields","limit","push","e","fullWidth","name","label","autoFocus","inputRef","required","helperText","message","type","color","module","exports","Boolean","window","location","hostname","match","tagCloudApi","tagList","PageUtil","pageToAllList","tagApi","Promise","all","map","id","tag","title","count","notesByTagId","length","TagCloud","useMount","tagCountList","countList","WordCloud","wordField","weightField","colorField","random","render","style","width","height","getData","noteList","noteLinks","md","MarkdownIt","noteIdMap","reduce","res","note","set","Map","findRelationByNote","parseInline","body","children","filter","attrGet","startsWith","substr","has","get","links","convert","nodes","replace","shape","nodeSize","Math","min","edges","flatMap","link","source","target","RelationMap","graphData","setGraphData","useState","layout","options","preset","preventOverlap","centripetalOptions","single","center","x","y","settingRouteName","relationRouteName","tagRouteName","sunburstRouteName","timelineName","chartList","configList","to","Home","Container","root","Card","CardHeader","CardContent","List","ListItem","CreateNoteDemo","snackbar","useSnackbar","folder","folderApi","listAll","create","parent_id","enqueueSnackbar","autoHideDuration","NotebookSunburst","sum","note_count","getNotebookSunburstData","Sunburst","reflect","seriesField","innerRadius","interactions","openNoteAction","NoteTimeline","noteListState","order_by","order_dir","loading","CircularProgress","Timeline","align","i","TimelineItem","TimelineOppositeContent","Typography","Date","user_updated_time","toLocaleString","TimelineSeparator","TimelineDot","TimelineConnector","TimelineContent","CardActions","Button","onClick","noteActionApi","openAndWatch","onOpenEditor","routeList","path","WebStorage","constructor","storage","clear","this","getItem","key","index","removeItem","setItem","kSet","Set","Proxy","p","receiver","Reflect","JSON","parse","toString","undefined","stringify","proxyStorage","localStorage","settingForm","App","renderRoutes","ReactDOM","StrictMode","locale","maxSnack","document","getElementById","serviceWorker","ready","then","registration","unregister","catch","msg"],"mappings":"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","file":"static/js/main.b1ae3c34.chunk.js","sourcesContent":["import {\r\n  Button,\r\n  Container,\r\n  Grid,\r\n  TextField,\r\n  Typography,\r\n} from '@material-ui/core'\r\nimport * as React from 'react'\r\nimport css from './JoplinSetting.module.css'\r\nimport { useForm } from 'react-hook-form'\r\nimport { config, noteApi } from 'joplin-api'\r\nimport { useAsync, useLocalStorage } from 'react-use'\r\nimport { useHistory } from 'react-router'\r\nimport { SettingForm } from './model/SettingForm'\r\nimport i18next, { InitOptions } from 'i18next'\r\nimport { useMessage } from '../../common/hooks/useMessage'\r\n\r\ntype PropsType = {}\r\n\r\ntype LocaleKeys =\r\n  | 'successMsg'\r\n  | 'errorMsg'\r\n  | 'settingFormHeader'\r\n  | 'tokenLabel'\r\n  | 'tokenErrorRequiredMsg'\r\n  | 'portLabel'\r\n  | 'portErrorRequiredMsg'\r\n  | 'submitText'\r\n\r\nconst i18nOptions: InitOptions = {\r\n  lng: navigator.language,\r\n  fallbackLng: 'en',\r\n  resources: {\r\n    en: {\r\n      translation: {\r\n        successMsg:\r\n          'The verification is successful, and you are about to enter the homepage',\r\n        errorMsg:\r\n          'Verification failed, please check whether the authorization token and port number are correct',\r\n        settingFormHeader: 'Settings page',\r\n        tokenLabel: 'Token',\r\n        tokenErrorRequiredMsg: 'Token is required',\r\n        portLabel: 'Port',\r\n        portErrorRequiredMsg: 'Port is required',\r\n        submitText: 'Submit',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n    'zh-CN': {\r\n      translation: {\r\n        successMsg: '验证成功，即将进入主页',\r\n        errorMsg: '验证失败，请检查授权 token 令牌与端口号是否正确',\r\n        settingFormHeader: '设置页',\r\n        tokenLabel: '授权 Token 令牌',\r\n        tokenErrorRequiredMsg: 'token 是必填项',\r\n        portLabel: '端口',\r\n        portErrorRequiredMsg: '端口是必填项',\r\n        submitText: '提交',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n  },\r\n}\r\n\r\n/**\r\n * joplin 配置页面\r\n */\r\nconst JoplinSetting: React.FC<PropsType> = () => {\r\n  const i18nLoad = useAsync(() => i18next.init(i18nOptions), [])\r\n  const { register, handleSubmit, errors } = useForm<SettingForm>({\r\n    defaultValues: {\r\n      port: 41184,\r\n    },\r\n  })\r\n\r\n  const [, setSettingForm] = useLocalStorage<SettingForm>('settingForm')\r\n  const history = useHistory()\r\n\r\n  const { success, error } = useMessage()\r\n\r\n  async function onSubmit(data: SettingForm) {\r\n    console.log('handleSubmit: ', data)\r\n    try {\r\n      config.token = data.token\r\n      config.port = data.port\r\n      await noteApi.list({\r\n        fields: [],\r\n        limit: 1,\r\n      })\r\n      setSettingForm(config)\r\n      success(i18next.t<string, LocaleKeys>('successMsg'))\r\n      history.push('/')\r\n    } catch (e) {\r\n      error(i18next.t<string, LocaleKeys>('errorMsg'))\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {i18nLoad.value && (\r\n        <Grid\r\n          container\r\n          justify=\"center\"\r\n          alignItems=\"center\"\r\n          className={css.container}\r\n        >\r\n          {\r\n            <Container maxWidth=\"xs\">\r\n              <Typography component=\"h1\" variant=\"h5\">\r\n                {i18next.t<string, LocaleKeys>('settingFormHeader')}\r\n              </Typography>\r\n              <form onSubmit={handleSubmit(onSubmit)}>\r\n                <TextField\r\n                  fullWidth\r\n                  name=\"token\"\r\n                  label={i18next.t<string, LocaleKeys>('tokenLabel')}\r\n                  autoFocus\r\n                  error={!!errors.token}\r\n                  inputRef={register({\r\n                    required: i18next.t<string, LocaleKeys>(\r\n                      'tokenErrorRequiredMsg',\r\n                    ),\r\n                  })}\r\n                  helperText={!!errors.token ? errors.token.message : ' '}\r\n                />\r\n                <TextField\r\n                  fullWidth\r\n                  name=\"port\"\r\n                  label={i18next.t<string, LocaleKeys>('portLabel')}\r\n                  error={!!errors.port}\r\n                  inputRef={register({\r\n                    required: i18next.t<string, LocaleKeys>(\r\n                      'portErrorRequiredMsg',\r\n                    ),\r\n                  })}\r\n                  helperText={!!errors.port ? errors.port.message : ' '}\r\n                />\r\n                <Button\r\n                  type=\"submit\"\r\n                  fullWidth\r\n                  variant=\"contained\"\r\n                  color=\"primary\"\r\n                >\r\n                  {i18next.t<string, LocaleKeys>('submitText')}\r\n                </Button>\r\n              </form>\r\n            </Container>\r\n          }\r\n        </Grid>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default JoplinSetting\r\n","export { default } from './JoplinSetting'\r\nexport * from './model/SettingForm'\r\n\r\n\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"JoplinSetting_container__3qmxA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Home_root__y74vd\"};","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import { PageUtil, tagApi } from 'joplin-api'\r\n\r\nexport interface TagModel {\r\n  id: string\r\n  tag: string\r\n  count: number\r\n}\r\n\r\nexport class TagCloudApi {\r\n  async countList() {\r\n    const tagList = await PageUtil.pageToAllList(tagApi.list)\r\n    return (await Promise.all(\r\n      tagList.map(async (tag) => ({\r\n        id: tag.id,\r\n        tag: tag.title,\r\n        count: (\r\n          await PageUtil.pageToAllList(tagApi.notesByTagId as any, {\r\n            id: tag.id,\r\n          })\r\n        ).length,\r\n      })),\r\n    )) as TagModel[]\r\n  }\r\n}\r\n\r\nexport const tagCloudApi = new TagCloudApi()\r\n","import * as React from 'react'\r\nimport { tagCloudApi } from './api/TagCloudApi'\r\nimport { useMount } from 'react-use'\r\nimport { WordCloud } from '@antv/g2plot'\r\nimport i18next, { InitOptions } from 'i18next'\r\nimport { useMessage } from '../../common/hooks/useMessage'\r\n\r\ntype PropsType = {}\r\n\r\ntype LocaleKeys = 'successMsg' | 'errorMsg'\r\n\r\nconst i18nOptions: InitOptions = {\r\n  lng: navigator.language,\r\n  fallbackLng: 'en',\r\n  resources: {\r\n    en: {\r\n      translation: {\r\n        successMsg: 'Successfully loaded the joplin tag list',\r\n        errorMsg: 'Failed to load joplin tag list',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n    'zh-CN': {\r\n      translation: {\r\n        successMsg: 'Joplin 标签列表加载成功',\r\n        errorMsg: 'Joplin 标签列表加载失败',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n  },\r\n}\r\n\r\n/**\r\n * 标签云\r\n */\r\nconst TagCloud: React.FC<PropsType> = () => {\r\n  const { success, error } = useMessage()\r\n  useMount(async () => {\r\n    await i18next.init(i18nOptions)\r\n    try {\r\n      const tagCountList = await tagCloudApi.countList()\r\n      const wordCloud = new WordCloud('container', {\r\n        data: tagCountList,\r\n        wordField: 'tag',\r\n        weightField: 'count',\r\n        colorField: 'tag',\r\n        random: () => 0.5,\r\n      })\r\n      wordCloud.render()\r\n      success(i18next.t<string, LocaleKeys>('successMsg'))\r\n    } catch (e) {\r\n      console.error(e)\r\n      error(i18next.t<string, LocaleKeys>('errorMsg'))\r\n    }\r\n  })\r\n\r\n  return <div id=\"container\" style={{ width: '100%', height: '100vh' }} />\r\n}\r\n\r\nexport default TagCloud\r\n","import * as React from 'react'\r\nimport { useMount } from 'react-use'\r\nimport { noteApi, PageUtil } from 'joplin-api'\r\nimport { NoteRelationConvertUtil } from './util/NoteRelationConvertUtil'\r\nimport Graphin, { Data, Edge, Node } from '@antv/graphin'\r\nimport '@antv/graphin/dist/index.css'\r\nimport { useState } from 'react'\r\nimport { useHistory } from 'react-router'\r\nimport i18next, { InitOptions } from 'i18next'\r\nimport { useMessage } from '../../common/hooks/useMessage'\r\n\r\ntype PropsType = {}\r\n\r\ntype LocaleKeys = 'successMsg' | 'errorMsg'\r\n\r\nconst i18nOptions: InitOptions = {\r\n  lng: navigator.language,\r\n  fallbackLng: 'en',\r\n  resources: {\r\n    en: {\r\n      translation: {\r\n        successMsg: 'Succeeded in loading note diagram',\r\n        errorMsg: 'Failed to load note diagram',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n    'zh-CN': {\r\n      translation: {\r\n        successMsg: '加载笔记关系图成功',\r\n        errorMsg: '加载笔记关系图失败',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n  },\r\n}\r\n\r\nasync function getData() {\r\n  const noteList = await PageUtil.pageToAllList(noteApi.list, {\r\n    fields: ['id', 'title', 'body'],\r\n  })\r\n  const noteLinks = NoteRelationConvertUtil.convert(noteList)\r\n  const data: Data = {\r\n    nodes: noteLinks.map((note) => {\r\n      const data = {\r\n        id: note.id,\r\n        label: note.title.startsWith('#')\r\n          ? note.title.replace('# ', '')\r\n          : note.title,\r\n      }\r\n      return {\r\n        data,\r\n        ...data,\r\n        shape: 'CircleNode',\r\n        style: {\r\n          nodeSize: 24 * Math.min(1 + note.links.length, 5),\r\n        },\r\n      } as Node\r\n    }),\r\n    edges: noteLinks.flatMap((note) =>\r\n      note.links.map((link) => {\r\n        const data = {\r\n          source: note.id,\r\n          target: link.id,\r\n        }\r\n        return {\r\n          data,\r\n          ...data,\r\n        } as Edge\r\n      }),\r\n    ),\r\n  }\r\n  return data\r\n}\r\n\r\n/**\r\n * 笔记关系图\r\n */\r\nconst RelationMap: React.FC<PropsType> = () => {\r\n  const [graphData, setGraphData] = useState<Data>({ edges: [], nodes: [] })\r\n\r\n  const { success, error } = useMessage()\r\n  const history = useHistory()\r\n  useMount(async () => {\r\n    await i18next.init(i18nOptions)\r\n    try {\r\n      const data = await getData()\r\n      setGraphData(data)\r\n      success(i18next.t<string, LocaleKeys>('successMsg'))\r\n    } catch (e) {\r\n      error(i18next.t<string, LocaleKeys>('errorMsg'))\r\n      history.push('/setting')\r\n    }\r\n  })\r\n  return (\r\n    <div style={{ height: '100vh' }}>\r\n      <Graphin\r\n        data={graphData}\r\n        layout={{\r\n          name: 'force',\r\n          options: {\r\n            preset: { name: 'concentric' },\r\n            preventOverlap: true,\r\n            centripetalOptions: {\r\n              single: 100, // 给孤立节点设置原来 （100/2）倍的向心力\r\n              center: () => {\r\n                // 根据不同的节点与度数设置不同的向心力的中心点\r\n                return {\r\n                  x: 100,\r\n                  y: 100,\r\n                }\r\n              },\r\n            },\r\n          },\r\n        }}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default RelationMap\r\n","import MarkdownIt from 'markdown-it'\r\nimport { NoteGetRes } from 'joplin-api/dist/modal/NoteGetRes'\r\nimport { NoteProperties } from 'joplin-api/dist/modal/NoteProperties'\r\n\r\nexport type Note = Pick<NoteGetRes, 'id' | 'title'> & {\r\n  links: Pick<NoteGetRes, 'id' | 'title'>[]\r\n}\r\n\r\ntype RelationNote = Pick<NoteProperties, 'id' | 'title' | 'body'>\r\n\r\nexport class NoteRelationConvertUtil {\r\n  static convert(noteList: RelationNote[]): Note[] {\r\n    const md = new MarkdownIt()\r\n    const noteIdMap = noteList.reduce((res, note) => {\r\n      res.set(note.id, note)\r\n      return res\r\n    }, new Map<string, RelationNote>())\r\n\r\n    function findRelationByNote(note: RelationNote) {\r\n      const tokenList = md.parseInline(note.body, '')\r\n      return tokenList[0]\r\n        .children!.filter((token) => {\r\n          return (\r\n            token.type === 'link_open' &&\r\n            token.attrGet('href')?.startsWith(':/')\r\n          )\r\n        })\r\n        .map((token) => {\r\n          return token.attrGet('href')?.substr(2)!\r\n        })\r\n        .filter((id) => {\r\n          return noteIdMap.has(id)\r\n        })\r\n        .map((id) => ({\r\n          id,\r\n          title: noteIdMap.get(id)!.title,\r\n        }))\r\n    }\r\n\r\n    return noteList.map(\r\n      (note) =>\r\n        ({\r\n          id: note.id,\r\n          title: note.title,\r\n          links: findRelationByNote(note),\r\n        } as Note),\r\n    )\r\n  }\r\n}\r\n","import * as React from 'react'\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardHeader,\r\n  Container,\r\n  List,\r\n  ListItem,\r\n} from '@material-ui/core'\r\nimport i18next, { InitOptions } from 'i18next'\r\nimport css from './Home.module.css'\r\nimport { useAsync } from 'react-use'\r\nimport { Link } from 'react-router-dom'\r\n\r\ntype PropsType = {}\r\n\r\ntype LocaleKeys =\r\n  | 'settingRouteName'\r\n  | 'relationRouteName'\r\n  | 'tagRouteName'\r\n  | 'sunburstRouteName'\r\n  | 'timelineName'\r\n  | 'chartList'\r\n\r\nconst i18nOptions: InitOptions = {\r\n  lng: navigator.language,\r\n  fallbackLng: 'en',\r\n  resources: {\r\n    en: {\r\n      translation: {\r\n        settingRouteName: 'Set up Joplin Token/Port',\r\n        relationRouteName: 'Relation chart',\r\n        tagRouteName: 'Tag Cloud',\r\n        sunburstRouteName: 'Note directory size analysis chart',\r\n        timelineName: 'timeline',\r\n        chartList: 'Chart list',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n    'zh-CN': {\r\n      translation: {\r\n        settingRouteName: '设置 Joplin Token/Port',\r\n        relationRouteName: '关系图',\r\n        tagRouteName: '标签云',\r\n        sunburstRouteName: '笔记目录大小分析图',\r\n        timelineName: '时间线',\r\n        chartList: '图表列表',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n  },\r\n}\r\n\r\nconst configList: { label: LocaleKeys; to: string }[] = [\r\n  { label: 'settingRouteName', to: '/setting' },\r\n  { label: 'tagRouteName', to: '/tag' },\r\n  { label: 'relationRouteName', to: '/relation' },\r\n  { label: 'sunburstRouteName', to: '/sunburst' },\r\n  { label: 'timelineName', to: '/timeline' },\r\n]\r\n\r\n/**\r\n * 首页\r\n */\r\nconst Home: React.FC<PropsType> = () => {\r\n  const i18nLoad = useAsync(() => i18next.init(i18nOptions), [])\r\n  return (\r\n    <>\r\n      {i18nLoad.value && (\r\n        <Container maxWidth=\"sm\" className={css.root}>\r\n          {\r\n            <Card>\r\n              <CardHeader title={i18next.t<string, LocaleKeys>('chartList')} />\r\n              <CardContent>\r\n                <List component=\"nav\">\r\n                  {configList.map((config) => (\r\n                    <ListItem>\r\n                      <Link to={config.to}>\r\n                        {i18next.t<string, LocaleKeys>(config.label)}\r\n                      </Link>\r\n                    </ListItem>\r\n                  ))}\r\n                </List>\r\n              </CardContent>\r\n            </Card>\r\n          }\r\n        </Container>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Home\r\n","import * as React from 'react'\r\nimport { useSnackbar } from 'notistack'\r\nimport { useMount } from 'react-use'\r\nimport { folderApi, noteApi } from 'joplin-api'\r\n\r\ntype PropsType = {}\r\n\r\nconst CreateNoteDemo: React.FC<PropsType> = () => {\r\n  const snackbar = useSnackbar()\r\n  useMount(async () => {\r\n    const folderList = await folderApi.listAll()\r\n    const folder = folderList[0]\r\n    const res = await noteApi.create({\r\n      title: 'test title',\r\n      body: 'test body',\r\n      parent_id: folder.id,\r\n    })\r\n    snackbar.enqueueSnackbar(\r\n      `Create note successfully: [${res.title}], The list of notes is: [${folder.title}]`,\r\n      {\r\n        variant: 'success',\r\n        autoHideDuration: 3000,\r\n      },\r\n    )\r\n  })\r\n  return <div>CreateNoteDemo</div>\r\n}\r\n\r\nexport default CreateNoteDemo\r\n","import * as React from 'react'\r\nimport { useMount } from 'react-use'\r\nimport { Sunburst } from '@antv/g2plot'\r\nimport { getNotebookSunburstData } from './util/getNotebookSunburstData'\r\nimport i18next, { InitOptions } from 'i18next'\r\nimport { useMessage } from '../../common/hooks/useMessage'\r\n\r\ntype SunburstProps = {}\r\n\r\ntype LocaleKeys = 'successMsg' | 'errorMsg'\r\n\r\nconst i18nOptions: InitOptions = {\r\n  lng: navigator.language,\r\n  fallbackLng: 'en',\r\n  resources: {\r\n    en: {\r\n      translation: {\r\n        successMsg: 'The notebook list is loaded successfully',\r\n        errorMsg: 'Failed to load notebook list',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n    'zh-CN': {\r\n      translation: {\r\n        successMsg: '笔记本列表加载成功',\r\n        errorMsg: '笔记本列表加载失败',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n  },\r\n}\r\n\r\n/**\r\n * 笔记目录大小分析图\r\n */\r\nconst NotebookSunburst: React.FC<SunburstProps> = () => {\r\n  const { success, error } = useMessage()\r\n  useMount(async () => {\r\n    await i18next.init(i18nOptions)\r\n    try {\r\n      const data = await getNotebookSunburstData()\r\n      success(i18next.t<string, LocaleKeys>('successMsg'))\r\n      const sunburstPlot = new Sunburst('container', {\r\n        data,\r\n        type: 'treemap',\r\n        reflect: 'y',\r\n        seriesField: 'sum',\r\n        colorField: 'label',\r\n        innerRadius: 0.3,\r\n        interactions: [{ type: 'element-active' }],\r\n      })\r\n      sunburstPlot.render()\r\n    } catch (e) {\r\n      error(i18next.t<string, LocaleKeys>('errorMsg'))\r\n    }\r\n  })\r\n  return <div id={'container'} style={{ height: '100vh' }} />\r\n}\r\n\r\nexport default NotebookSunburst\r\n","import { folderApi } from 'joplin-api'\r\nimport { FolderListAllRes } from 'joplin-api/dist/modal/FolderListAllRes'\r\n\r\nexport type SunburstData = {\r\n  label: string\r\n  children?: SunburstData[]\r\n  sum?: number\r\n}\r\n\r\nexport async function getNotebookSunburstData() {\r\n  const folderList = await folderApi.listAll()\r\n\r\n  function convert(folder: FolderListAllRes): SunburstData {\r\n    return {\r\n      label: folder.title,\r\n      sum: folder.note_count,\r\n      children: folder.children?.map(convert),\r\n    }\r\n  }\r\n\r\n  return {\r\n    label: 'root',\r\n    children: folderList.map(convert),\r\n  }\r\n}\r\n","import * as React from 'react'\r\nimport { useAsync, useMount } from 'react-use'\r\nimport { noteActionApi, noteApi, PageUtil } from 'joplin-api'\r\nimport Timeline from '@material-ui/lab/Timeline'\r\nimport TimelineItem from '@material-ui/lab/TimelineItem'\r\nimport TimelineSeparator from '@material-ui/lab/TimelineSeparator'\r\nimport TimelineConnector from '@material-ui/lab/TimelineConnector'\r\nimport TimelineContent from '@material-ui/lab/TimelineContent'\r\nimport TimelineDot from '@material-ui/lab/TimelineDot'\r\nimport {\r\n  Button,\r\n  Card,\r\n  CardActions,\r\n  CardContent,\r\n  CircularProgress,\r\n  Typography,\r\n} from '@material-ui/core'\r\nimport { TimelineOppositeContent } from '@material-ui/lab'\r\nimport i18next, { InitOptions } from 'i18next'\r\n\r\ntype NoteTimelineProps = {}\r\n\r\ntype LocaleKeys = 'openNoteAction'\r\n\r\nconst i18nOptions: InitOptions = {\r\n  lng: navigator.language,\r\n  fallbackLng: 'en',\r\n  resources: {\r\n    en: {\r\n      translation: {\r\n        openNoteAction: 'Open in editor',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n    'zh-CN': {\r\n      translation: {\r\n        openNoteAction: '在编辑器中打开',\r\n      } as Record<LocaleKeys, string>,\r\n    },\r\n  },\r\n}\r\n\r\n/**\r\n * 笔记的时间线\r\n */\r\nconst NoteTimeline: React.FC<NoteTimelineProps> = () => {\r\n  const noteListState = useAsync(async () => {\r\n    return await PageUtil.pageToAllList(noteApi.list, {\r\n      fields: ['id', 'title', 'body', 'user_updated_time'],\r\n      order_by: 'user_updated_time',\r\n      order_dir: 'DESC',\r\n    })\r\n  }, [])\r\n\r\n  useMount(async () => {\r\n    await i18next.init(i18nOptions)\r\n  })\r\n\r\n  async function onOpenEditor(id: string) {\r\n    await noteActionApi.openAndWatch(id)\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {noteListState.loading ? (\r\n        <CircularProgress />\r\n      ) : (\r\n        <Timeline align=\"alternate\">\r\n          {noteListState.value!.map((note, i) => (\r\n            <TimelineItem>\r\n              <TimelineOppositeContent>\r\n                <Typography color=\"textSecondary\">\r\n                  {new Date(note.user_updated_time).toLocaleString()}\r\n                </Typography>\r\n              </TimelineOppositeContent>\r\n              <TimelineSeparator>\r\n                <TimelineDot color={i % 2 === 0 ? 'primary' : 'secondary'} />\r\n                <TimelineConnector />\r\n              </TimelineSeparator>\r\n              <TimelineContent>\r\n                <Card>\r\n                  <CardContent>\r\n                    <Typography variant={'h5'}>\r\n                      {note.title.startsWith('#')\r\n                        ? note.title.replace('# ', '')\r\n                        : note.title}\r\n                    </Typography>\r\n                  </CardContent>\r\n                  <CardActions>\r\n                    <Button onClick={() => onOpenEditor(note.id)}>\r\n                      {i18next.t<string, LocaleKeys>('openNoteAction')}\r\n                    </Button>\r\n                  </CardActions>\r\n                </Card>\r\n              </TimelineContent>\r\n            </TimelineItem>\r\n          ))}\r\n        </Timeline>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default NoteTimeline\r\n","import { RouteConfig } from 'react-router-config'\r\nimport TagCloud from '../../pages/tag'\r\nimport RelationMap from '../../pages/relation'\r\nimport JoplinSetting from '../../pages/setting'\r\nimport Home from '../../pages/home'\r\nimport CreateNoteDemo from '../../pages/demo'\r\nimport NotebookSunburst from '../../pages/sunburst'\r\nimport NoteTimeline from '../../pages/timeline/NoteTimeline'\r\n\r\nexport const routeList: RouteConfig[] = [\r\n  {\r\n    path: '/setting',\r\n    component: JoplinSetting,\r\n  },\r\n  {\r\n    path: '/tag',\r\n    component: TagCloud,\r\n  },\r\n  {\r\n    path: '/sunburst',\r\n    component: NotebookSunburst,\r\n  },\r\n  {\r\n    path: '/relation',\r\n    component: RelationMap,\r\n  },\r\n  {\r\n    path: '/demo/create-note',\r\n    component: CreateNoteDemo,\r\n  },\r\n  {\r\n    path: '/timeline',\r\n    component: NoteTimeline,\r\n  },\r\n\r\n  {\r\n    path: '/',\r\n    component: Home,\r\n  },\r\n]\r\n","class WebStorage implements Storage {\r\n  constructor(private storage: Storage) {}\r\n\r\n  get length() {\r\n    return this.storage.length\r\n  }\r\n\r\n  clear = (): void => {\r\n    this.storage.clear()\r\n  }\r\n\r\n  getItem = (key: string): string | null => this.storage.getItem(key)\r\n\r\n  key = (index: number): string | null => this.storage.key(index)\r\n\r\n  removeItem = (key: string): void => {\r\n    this.storage.removeItem(key)\r\n  }\r\n\r\n  setItem = (key: string, value: string): void => {\r\n    this.storage.setItem(key, value)\r\n  }\r\n}\r\n\r\ntype StorageObject<T> = {\r\n  [P in keyof T]: T[P] extends object ? Readonly<T[P]> | null : T[P] | null\r\n}\r\n\r\n/**\r\n * 代理 Storage 使之更简单易用\r\n * @param storage\r\n */\r\nexport function proxyStorage<T extends object>(\r\n  storage: Storage,\r\n): Storage & StorageObject<T> {\r\n  const kSet = new Set([\r\n    'storage',\r\n    'length',\r\n    'clear',\r\n    'getItem',\r\n    'setItem',\r\n    'removeItem',\r\n    'key',\r\n  ] as (keyof Storage)[])\r\n  return new Proxy(new WebStorage(storage), {\r\n    get(target: Storage, p: string, receiver: any): any {\r\n      if (kSet.has(p)) {\r\n        return Reflect.get(target, p, receiver)\r\n      }\r\n      try {\r\n        return JSON.parse(target.getItem(p.toString())!)\r\n      } catch (e) {\r\n        return null\r\n      }\r\n    },\r\n    set(target: Storage, p: string, value: any, receiver: any): boolean {\r\n      if (kSet.has(p as any)) {\r\n        return Reflect.set(target, p, receiver)\r\n      }\r\n      target.setItem(\r\n        p.toString(),\r\n        value !== undefined && value !== null ? JSON.stringify(value) : value,\r\n      )\r\n      return true\r\n    },\r\n  }) as any\r\n}\r\n","import * as React from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\nimport { renderRoutes } from 'react-router-config'\r\nimport { routeList } from './component/router/routeList'\r\nimport { useLocalStorage, useMount } from 'react-use'\r\nimport { SettingForm } from './pages/setting'\r\nimport { config } from 'joplin-api'\r\nimport { proxyStorage } from './common/util/proxyStorage'\r\n\r\ntype PropsType = {}\r\n\r\n//初始化 storage\r\nconst storage = proxyStorage<{ settingForm: SettingForm }>(localStorage)\r\nconfig.token = storage.settingForm?.token!\r\nconfig.port = storage.settingForm?.port!\r\n\r\nconst App: React.FC<PropsType> = () => {\r\n  const [settingForm] = useLocalStorage<SettingForm>('settingForm')\r\n  const history = useHistory()\r\n  useMount(() => {\r\n    if (!settingForm?.token || !settingForm?.port) {\r\n      history.push('/setting')\r\n      return\r\n    }\r\n  })\r\n  return renderRoutes(routeList)\r\n}\r\n\r\nexport default App\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport * as serviceWorker from './serviceWorker'\r\nimport App from './App'\r\nimport 'normalize.css'\r\nimport { IntlProvider } from 'react-intl'\r\nimport { SnackbarProvider } from 'notistack'\r\nimport { HashRouter } from 'react-router-dom'\r\nimport '@antv/graphin/dist/index.css'\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <IntlProvider locale={window.navigator.language}>\r\n      <SnackbarProvider maxSnack={3}>\r\n        <HashRouter>\r\n          <App />\r\n        </HashRouter>\r\n      </SnackbarProvider>\r\n    </IntlProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root'),\r\n)\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister()\r\n","import { useSnackbar } from 'notistack'\r\n\r\nexport function useMessage() {\r\n  const snackbar = useSnackbar()\r\n  const autoHideDuration = 3000\r\n  return {\r\n    success(msg: string) {\r\n      snackbar.enqueueSnackbar(msg, {\r\n        variant: 'success',\r\n        autoHideDuration,\r\n      })\r\n    },\r\n    error(msg: string) {\r\n      snackbar.enqueueSnackbar(msg, {\r\n        variant: 'error',\r\n        autoHideDuration,\r\n      })\r\n    },\r\n  }\r\n}\r\n"],"sourceRoot":""}